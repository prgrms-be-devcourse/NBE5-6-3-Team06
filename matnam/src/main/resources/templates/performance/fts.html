<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÏÑ±Îä• ÎπÑÍµê ÌÖåÏä§Ìä∏ Í≤∞Í≥º</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .test-controls {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .form-group {
            display: flex;
            gap: 20px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }

        .form-control {
            padding: 12px 20px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .results-section {
            padding: 30px;
        }

        .comparison-overview {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .overview-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            transform: translateY(0);
            transition: all 0.3s ease;
        }

        .overview-card.winner {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        }

        .overview-card.difference {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            color: #2d3436;
        }

        .overview-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(240, 147, 251, 0.3);
        }

        .overview-value {
            font-size: 2.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .overview-label {
            font-size: 0.9em;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .method-stats {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .method-stats.like-stats {
            border-top: 4px solid #e17055;
        }

        .method-stats.fulltext-stats {
            border-top: 4px solid #74b9ff;
        }

        .method-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }

        .method-title.like {
            color: #e17055;
        }

        .method-title.fulltext {
            color: #74b9ff;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f8f9fa;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-weight: 500;
            color: #666;
        }

        .stat-value {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #333;
        }

        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .chart-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }

        .results-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        .results-list {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
        }

        .results-list.like-results {
            border-left: 4px solid #e17055;
        }

        .results-list.fulltext-results {
            border-left: 4px solid #74b9ff;
        }

        .results-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .result-item {
            background: white;
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .result-item:hover {
            transform: translateX(5px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .result-item:last-child {
            margin-bottom: 0;
        }

        .result-number {
            font-weight: bold;
            color: #667eea;
            font-size: 0.9em;
        }

        .result-time {
            font-family: 'Courier New', monospace;
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .test-info {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 12px;
        }

        .test-info-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .no-results {
            text-align: center;
            padding: 50px;
            color: #666;
        }

        .no-results h3 {
            margin-bottom: 15px;
            color: #333;
        }

        @media (max-width: 1024px) {
            .stats-grid, .results-comparison {
                grid-template-columns: 1fr;
            }
            
            .comparison-overview {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .form-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° ÏÑ±Îä• ÎπÑÍµê ÎåÄÏãúÎ≥¥Îìú</h1>
            <p>LIKE vs Full-Text Í≤ÄÏÉâ ÏÑ±Îä• ÎπÑÍµê Î∞è Î∂ÑÏÑù</p>
        </div>

        <div class="test-controls">
            <form action="/performance/fts" method="get" class="form-group">
                <input type="text" name="keyword" placeholder="Í≤ÄÏÉâ ÌÇ§ÏõåÎìú ÏûÖÎ†•" 
                       class="form-control" th:value="${param.keyword}" required>
                
                <button type="submit" class="btn">üî• ÎπÑÍµê ÌÖåÏä§Ìä∏ ÏãúÏûë</button>
            </form>
        </div>

        <!-- Í≤∞Í≥ºÍ∞Ä ÏûàÏùÑ ÎïåÎßå ÌëúÏãú -->
        <div class="results-section" th:if="${likeResults != null and fullTextResults != null}">
            <!-- ÎπÑÍµê Í∞úÏöî -->
            <div class="comparison-overview">
                <div class="overview-card winner">
                    <div class="overview-value" id="winnerName">-</div>
                    <div class="overview-label">Îçî Îπ†Î•∏ Î∞©Ïãù</div>
                </div>
                <div class="overview-card">
                    <div class="overview-value" id="winnerTime">-</div>
                    <div class="overview-label">ÏäπÏûê ÌèâÍ∑†ÏãúÍ∞Ñ (Ï¥à)</div>
                </div>
                <div class="overview-card difference">
                    <div class="overview-value" id="timeDifference">-</div>
                    <div class="overview-label">ÏÑ±Îä• Ï∞®Ïù¥ (Î∞∞)</div>
                </div>
            </div>

            <!-- ÏÉÅÏÑ∏ ÌÜµÍ≥Ñ -->
            <div class="stats-grid">
                <div class="method-stats like-stats">
                    <h3 class="method-title like">üîç LIKE Í≤ÄÏÉâ</h3>
                    <div class="stat-row">
                        <span class="stat-label">ÌèâÍ∑† Ïã§ÌñâÏãúÍ∞Ñ</span>
                        <span class="stat-value" id="likeAvg">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ÏµúÏÜå Ïã§ÌñâÏãúÍ∞Ñ</span>
                        <span class="stat-value" id="likeMin">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ÏµúÎåÄ Ïã§ÌñâÏãúÍ∞Ñ</span>
                        <span class="stat-value" id="likeMax">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ÌÖåÏä§Ìä∏ ÌöüÏàò</span>
                        <span class="stat-value" th:text="${likeResults?.size() ?: 0}">0</span>
                    </div>
                </div>

                <div class="method-stats fulltext-stats">
                    <h3 class="method-title fulltext">‚ö° Full-Text Í≤ÄÏÉâ</h3>
                    <div class="stat-row">
                        <span class="stat-label">ÌèâÍ∑† Ïã§ÌñâÏãúÍ∞Ñ</span>
                        <span class="stat-value" id="fullTextAvg">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ÏµúÏÜå Ïã§ÌñâÏãúÍ∞Ñ</span>
                        <span class="stat-value" id="fullTextMin">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ÏµúÎåÄ Ïã§ÌñâÏãúÍ∞Ñ</span>
                        <span class="stat-value" id="fullTextMax">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ÌÖåÏä§Ìä∏ ÌöüÏàò</span>
                        <span class="stat-value" th:text="${fullTextResults?.size() ?: 0}">0</span>
                    </div>
                </div>
            </div>

            <!-- ÎπÑÍµê Ï∞®Ìä∏ -->
            <div class="chart-container">
                <div class="chart-title">üìä ÏÑ±Îä• ÎπÑÍµê Ï∞®Ìä∏</div>
                <div style="height: 400px; position: relative;">
                    <canvas id="comparisonChart"></canvas>
                </div>
            </div>

            <!-- Ïã§ÌñâÏãúÍ∞Ñ Ï∂îÏù¥ Ï∞®Ìä∏ -->
            <div class="chart-container">
                <div class="chart-title">üìà Ïã§ÌñâÏãúÍ∞Ñ Ï∂îÏù¥ ÎπÑÍµê</div>
                <div style="height: 300px; position: relative;">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>

            <!-- ÏÉÅÏÑ∏ Í≤∞Í≥º -->
            <div class="results-comparison">
                <div class="results-list like-results">
                    <h3 class="results-title">üîç LIKE Í≤ÄÏÉâ ÏÉÅÏÑ∏ Í≤∞Í≥º</h3>
                    <div id="likeResultsList">
                        <div class="result-item" th:each="result, iterStat : ${likeResults}">
                            <span class="result-number" th:text="${iterStat.index + 1} + 'Ìöå'"></span>
                            <span class="result-time" th:text="${result}"></span>
                        </div>
                    </div>
                </div>

                <div class="results-list fulltext-results">
                    <h3 class="results-title">‚ö° Full-Text Í≤ÄÏÉâ ÏÉÅÏÑ∏ Í≤∞Í≥º</h3>
                    <div id="fullTextResultsList">
                        <div class="result-item" th:each="result, iterStat : ${fullTextResults}">
                            <span class="result-number" th:text="${iterStat.index + 1} + 'Ìöå'"></span>
                            <span class="result-time" th:text="${result}"></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="test-info">
                <div class="test-info-title">üîç ÌÖåÏä§Ìä∏ Ï†ïÎ≥¥</div>
                <div>
                    <strong>Í≤ÄÏÉâ ÌÇ§ÏõåÎìú:</strong> <span th:text="${param.keyword}">-</span><br>
                    <strong>ÌÖåÏä§Ìä∏ ÏãúÍ∞Ñ:</strong> <span id="testTime">-</span>
                </div>
            </div>
        </div>

        <!-- Í≤∞Í≥ºÍ∞Ä ÏóÜÏùÑ Îïå ÌëúÏãú -->
        <div class="no-results" th:if="${likeResults == null or fullTextResults == null}">
            <h3>üéØ ÏÑ±Îä• ÎπÑÍµê ÌÖåÏä§Ìä∏Î•º ÏãúÏûëÌï¥Î≥¥ÏÑ∏Ïöî!</h3>
            <p>ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•ÌïòÍ≥† ÌÖåÏä§Ìä∏Î•º Ïã§ÌñâÌïòÎ©¥<br>
               LIKE Í≤ÄÏÉâÍ≥º Full-Text Í≤ÄÏÉâÏùò ÏÑ±Îä•ÏùÑ ÎπÑÍµêÌï¥ÎìúÎ¶ΩÎãàÎã§.</p>
        </div>
    </div>

    <script th:inline="javascript">
        // ÏÑúÎ≤ÑÏóêÏÑú Ï†ÑÎã¨Î∞õÏùÄ Ïã§Ï†ú Îç∞Ïù¥ÌÑ∞
        const likeResults = /*[[${likeResults}]]*/ [];
        const fullTextResults = /*[[${fullTextResults}]]*/ [];
        const hasResults = likeResults && fullTextResults && likeResults.length > 0 && fullTextResults.length > 0;

        if (hasResults) {
            // Ïã§ÌñâÏãúÍ∞Ñ Í∞íÎì§ Ï∂îÏ∂ú
            const likeTimes = extractTimes(likeResults);
            const fullTextTimes = extractTimes(fullTextResults);

            console.log('LIKE ÏãúÍ∞Ñ Í∞íÎì§:', likeTimes);
            console.log('Full-Text ÏãúÍ∞Ñ Í∞íÎì§:', fullTextTimes);

            if (likeTimes.length > 0 && fullTextTimes.length > 0) {
                calculateAndDisplayStats(likeTimes, fullTextTimes);
                createComparisonChart(likeTimes, fullTextTimes);
                createTrendChart(likeTimes, fullTextTimes);
            }

            // ÌÖåÏä§Ìä∏ ÏãúÍ∞Ñ ÌëúÏãú
            document.getElementById('testTime').textContent = new Date().toLocaleString('ko-KR');
        }

        function extractTimes(results) {
            return results.map(result => {
                const match = result.match(/(\d+\.\d+)Ï¥à/);
                return match ? parseFloat(match[1]) : 0;
            }).filter(time => time > 0);
        }

        function calculateAndDisplayStats(likeTimes, fullTextTimes) {
            // ÌÜµÍ≥Ñ Í≥ÑÏÇ∞
            const likeAvg = likeTimes.reduce((a, b) => a + b, 0) / likeTimes.length;
            const likeMin = Math.min(...likeTimes);
            const likeMax = Math.max(...likeTimes);

            const fullTextAvg = fullTextTimes.reduce((a, b) => a + b, 0) / fullTextTimes.length;
            const fullTextMin = Math.min(...fullTextTimes);
            const fullTextMax = Math.max(...fullTextTimes);

            // ÌÜµÍ≥Ñ ÌëúÏãú
            document.getElementById('likeAvg').textContent = likeAvg.toFixed(6) + 'Ï¥à';
            document.getElementById('likeMin').textContent = likeMin.toFixed(6) + 'Ï¥à';
            document.getElementById('likeMax').textContent = likeMax.toFixed(6) + 'Ï¥à';

            document.getElementById('fullTextAvg').textContent = fullTextAvg.toFixed(6) + 'Ï¥à';
            document.getElementById('fullTextMin').textContent = fullTextMin.toFixed(6) + 'Ï¥à';
            document.getElementById('fullTextMax').textContent = fullTextMax.toFixed(6) + 'Ï¥à';

            // ÏäπÏûê Í≤∞Ï†ï
            const winner = likeAvg < fullTextAvg ? 'LIKE' : 'Full-Text';
            const winnerTime = Math.min(likeAvg, fullTextAvg);
            const loserTime = Math.max(likeAvg, fullTextAvg);
            const difference = (loserTime / winnerTime).toFixed(1);

            document.getElementById('winnerName').textContent = winner;
            document.getElementById('winnerTime').textContent = winnerTime.toFixed(6);
            document.getElementById('timeDifference').textContent = difference + 'x';
        }

        function createComparisonChart(likeTimes, fullTextTimes) {
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            
            const likeAvg = likeTimes.reduce((a, b) => a + b, 0) / likeTimes.length;
            const fullTextAvg = fullTextTimes.reduce((a, b) => a + b, 0) / fullTextTimes.length;

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['ÌèâÍ∑† Ïã§ÌñâÏãúÍ∞Ñ', 'ÏµúÏÜå Ïã§ÌñâÏãúÍ∞Ñ', 'ÏµúÎåÄ Ïã§ÌñâÏãúÍ∞Ñ'],
                    datasets: [{
                        label: 'LIKE Í≤ÄÏÉâ',
                        data: [
                            likeTimes.reduce((a, b) => a + b, 0) / likeTimes.length,
                            Math.min(...likeTimes),
                            Math.max(...likeTimes)
                        ],
                        backgroundColor: 'rgba(225, 112, 85, 0.8)',
                        borderColor: '#e17055',
                        borderWidth: 2
                    }, {
                        label: 'Full-Text Í≤ÄÏÉâ',
                        data: [
                            fullTextTimes.reduce((a, b) => a + b, 0) / fullTextTimes.length,
                            Math.min(...fullTextTimes),
                            Math.max(...fullTextTimes)
                        ],
                        backgroundColor: 'rgba(116, 185, 255, 0.8)',
                        borderColor: '#74b9ff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Ïã§ÌñâÏãúÍ∞Ñ (Ï¥à)'
                            }
                        }
                    }
                }
            });
        }

        function createTrendChart(likeTimes, fullTextTimes) {
            const ctx = document.getElementById('trendChart').getContext('2d');
            
            const maxLength = Math.max(likeTimes.length, fullTextTimes.length);
            const labels = Array.from({length: maxLength}, (_, i) => `${i + 1}Ìöå`);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'LIKE Í≤ÄÏÉâ',
                        data: likeTimes,
                        borderColor: '#e17055',
                        backgroundColor: 'rgba(225, 112, 85, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.4,
                        pointBackgroundColor: '#e17055',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 5
                    }, {
                        label: 'Full-Text Í≤ÄÏÉâ',
                        data: fullTextTimes,
                        borderColor: '#74b9ff',
                        backgroundColor: 'rgba(116, 185, 255, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.4,
                        pointBackgroundColor: '#74b9ff',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Ïã§ÌñâÏãúÍ∞Ñ (Ï¥à)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'ÌÖåÏä§Ìä∏ ÌöåÏ∞®'
                            }
                        }
                    }
                }
            });
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú ÌõÑ Ïï†ÎãàÎ©îÏù¥ÏÖò Ìö®Í≥º
        window.addEventListener('load', function() {
            if (hasResults) {
                const resultItems = document.querySelectorAll('.result-item');
                resultItems.forEach((item, index) => {
                    setTimeout(() => {
                        item.style.opacity = '1';
                        item.style.transform = 'translateX(0)';
                    }, index * 50);
                });
            }
        });
    </script>
</body>
</html>